<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rain Predictor</title>
  </head>
  <body style="background-color: rgb(248, 248, 248); overflow: hidden" onload="get_todays_data(citySelect.value)">
    <div
      style="
        height: calc(100vh - 20px);
        width: 100%;
        display: grid;
        justify-items: center;
        align-items: center;
      "
    >
      <div class="blob" style="margin: auto">
        <h1 style="padding: 0.5rem; text-align: center">Rain Predictor</h1>
        <p style="padding: 0.5rem; text-align: center">
          Will it rain in
          <span>
            <select
              name="city"
              id="city"
              style="
                background-color: transparent;
                border-radius: 0.5rem;
                padding: 0rem 0.3rem 0rem 0.3rem;
              "
            >
              <option value="hobart">hobart</option>
              <option value="melbourne">melbourne</option>
              <option value="sydney">sydney</option>
            </select>
          </span>
          tomorrow?
        </p>

        <h3
        id="prediction"
          style="
            text-align: center;
            padding: 3rem;
            font-size: x-large;
            font-weight: 500;
          "
        >
          Yes
        </h3>
      </div>
    </div>
  </body>

  <style>

    body {
      padding: 0;
      margin: 0;
    }
    h1,
    h2,
    h3,
    p {
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }
    select {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }
  </style>

  <script>

      let citySelect = document.getElementById("city");
    
      citySelect.addEventListener("change", function() {
        
        get_todays_data(citySelect.value);

    });

    function get_rain_prediction(city, data) {
        console.log(data)
      fetch(`https://rain-predictor-api.herokuapp.com/predict/${city}`, {
        method: "POST",
        body: JSON.stringify(data),
        headers: {
            "Accept": "*/*",
          "Content-Type": "application/json",
          "Access-Control-Allow-Origin": "*",
        },
      })
      .then((response) => response.json())
      .then(data => {
          console.log(data)
          document.getElementById("prediction").innerHTML = data['prediction'];
      })
    }

    function get_todays_data(city) {
        document.getElementById("prediction").innerHTML = "Thinking ...";
      fetch(`https://rain-predictor-api.herokuapp.com/obs/${city}`, {
        headers: {
          "Access-Control-Allow-Origin": "*",
          "Access-Control-Request-Method": "GET",
          "Accept": "application/json"
        },
      })
      .then((response) => response.json())
      .then((data) => {
        get_rain_prediction(city, data);
      })
    }

    document.onload

  </script>
</html>
